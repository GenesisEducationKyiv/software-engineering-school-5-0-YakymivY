# Моніторинг

## Алерти

### База даних

- Час відповіді бази даних перевищує 500 мілісекунд
- Помилки зʼєднання з БД
- Збільшення кількості запитів до бази даних більш ніж на 50% за 5 хвилин

Сповіщають про надмірне навантаження або помилки підключення бази даних, що має критичний вплив на систему 

### Помилки

- Виникнення критичних помилок бізнес процесу: підписка/відписка, підтвердження, отримання даних про погоду
- Помилки підключення до Redis, RabbitMQ, Postgres

Сповіщають про помилки, що мають критичний вплив на систему або бізнес процес

### Продуктивність 

- Відповіді API довше 1 секунди
- Навантаженість CPU вища ніж 80% протягом 5 хвилин
- Використання памʼяті вище ніж 80% протягом 5 хвилин

Сповіщають про проблеми з продуктивністю, що має негативний ефект на користувацький досвід та може призвести до виведення системи з ладу

### Бізнес-метрики

- Велика кількість відписок/підписок
- Велика кількість підписок без підтверджень

Сповіщають про несподівані зміни в бізнес-метриках, що можуть вказувати на підозрілу активність в системі

### Зовнішні сервіси

- Помилки взаємодії з зовнішніми API 
- Надмірна затримка зовнішніх API

Сповіщають про необхідність перевірки підключення до зовнішніх API або зміни провайдерів

## Політика зберігання логів

### Категорії логів та їх політика зберігання

1. **Логи рівня ERROR**
- **Термін зберігання**: 90 днів
- **Архівація**: Автоматична, після 30 днів
- Окреме сховище зі швидким доступом 

2. **Логи бізнес-подій**
- **Термін зберігання**: 1 рік
- **Архівація**: Автоматична, кожного місяця
- Підписки/відписки, підтвердження, отримання даних про погоду

3. **Логи налагодження рівня DEBUG**
- **Термін зберігання**: 7 днів
- **Архівація**: Відсутня
- Вмикаються тільки при активованому рівні логування DEBUG

### Формат архівації 

- Логи зберігаються у форматі JSON
- Стискаються у файли типу `.tar.gz`
- Кожен архів містить логи за один день
- Імʼя архіву містить дату і тип логів

### Політика видалення логів

1. **Автоматичне видалення**:
   - Після закінчення терміну зберігання
   - При досягненні ліміту сховища (старі логи видаляються першими)

2. **Ручне видалення**:
   - Тільки для адміністраторів
   - З обов'язковим логуванням операції
   - З можливістю скасування протягом 7 днів
  
### Моніторинг використання сховища 

- Попередження при заповнені сховища на 80% 
- Критичне сповіщення при заповненні на 95% 
- Автоматичне очищення тимчасових файлів при відстутності місця