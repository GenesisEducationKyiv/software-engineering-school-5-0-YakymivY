# ADR-002: Винесення функціоналу надсилання листів у окремий мікросервіс

**Статус:** Прийнято  
**Дата:** 2025-07-07  
**Автор:** Yurii Yakymiv  

## Контекст
Наразі функціонал відправки електронних листів (підтвердження підписки, повідомлення з оновленнями погоди) реалізовано безпосередньо у монолітному веб-сервері. З ростом функціоналу та навантаження можуть виникнути проблеми:
- Час відповіді API збільшується через блокуючі SMTP/API виклики.
- Логіка обробки листів накладає зайві залежності (SMTP, постачальники email-API) на основний застосунок.
- Обмежені можливості горизонтального масштабування: потреба масштабувати весь веб-сервер лише заради пікового навантаження на email.
- Складність моніторингу: важко відстежити успішність чи збої відправок.

## Розглянуті варіанти

### 1. Залишити в моноліті
- **Переваги:** відсутність додаткової інфраструктури, мінімальні зміни коду.
- **Недоліки:** зростаюча складність програми, заблоковані HTTP-запити, неможливість незалежного масштабування email-частини, ризик впливу збоїв SMTP на всю систему.

### 2. Використати сторонній SaaS інструмент з Webhookʼами
- **Переваги:** мінімальна підтримка, вбудовані дашборди, масштабованість за рахунок постачальника.
- **Недоліки:** vendor lock-in, обмежена гнучкість шаблонів, залежність від тарифів, потрібна інтеграція веб-хуків.

### 3. Виділити окремий мікросервіс розсилки
- **Переваги:** чітка ізоляція відповідальності, незалежне горизонтальне масштабування, окрема схема моніторингу й логування, можливість змінювати email-постачальника без внесення змін у основний сервіс.
- **Недоліки:** необхідність додаткових CI/CD, інфраструктури (контейнер, брокер), складніший деплой.

## Прийняте рішення
Створити окремий мікросервіс `mailer-service`, що відповідатиме за формування шаблонів листів та відправку їх через SMTP або email API-постачальника. Комунікація між сервісами реалізується асинхронно через RabbitMQ (`ADR-003`).

## Наслідки

### Позитивні
- Зменшення часу відповіді основного API.
- Можливість масштабування відправки листів незалежно.
- Чіткі метрики (queue depth, успішність листів) та алерти для email-каналу.
- Легше обслуговувати й розвивати шаблони без змін в основному коді.

### Негативні
- Потрібен окремий репозиторій/папка із власним CI/CD.
- Більше компонентів для локального запуску та розгортання.
- Підвищені операційні витрати (моніторинг, резервування ресурсів).